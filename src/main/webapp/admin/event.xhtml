<!DOCTYPE html>

<ui:composition template="index.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="title">#{translation.event}</ui:define>
	<ui:define name="content">
		<div class="ui-fluid">
			<p:panelGrid columns="2" layout="grid"
				columnClasses="ui-grid-col-7,ui-grid-col-5">
				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank"
					columnClasses="ui-grid-col-3,ui-grid-col-9">
					<p:outputLabel value="#{translation.club}" style="font-weight:bold" />
					<!--
					<p:selectOneMenu value="#{selectedEventBean.event.club}" var="c">
						<f:selectItems value="#{clubBean.clubs}" var="club"
							itemLabel="#{club.name}" itemValue="#{club.id}" />
					</p:selectOneMenu>
					 -->
					<h:outputText value="#{selectedEventBean.event.club.name}" />
					<p:outputLabel value="#{translation.name}" style="font-weight:bold" />
					<h:inputText id="name" value="#{selectedEventBean.event.name}"
						styleClass="ui-grid-col-12" />

					<p:outputLabel value="#{translation.handicap}"
						style="font-weight:bold" />
					<p:selectBooleanCheckbox id="handicap"
						value="#{selectedEventBean.event.handicap}" />
				</p:panelGrid>

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank"
					columnClasses="ui-grid-col-6,ui-grid-col-6">
					<p:outputLabel value="#{translation.startDate}"
						style="font-weight:bold" />
					<p:calendar id="startDate"
						value="#{selectedEventBean.event.startDate}" navigator="true"
						pattern="dd.MM.yyyy" />
					<p:outputLabel value="#{translation.endDate}"
						style="font-weight:bold" />
					<p:calendar id="endDate" value="#{selectedEventBean.event.endDate}"
						navigator="true" pattern="dd.MM.yyyy" />
				</p:panelGrid>
			</p:panelGrid>
			<h:inputHidden id="rs-map-latitude"
				value="#{selectedEventBean.event.latitude}" />
			<h:inputHidden id="rs-map-longitude"
				value="#{selectedEventBean.event.longitude}" />
			<h:inputHidden id="rs-map-resolution" value="" />
			<h:inputHidden id="rs-map-rotation" value="" />
			<h:inputHidden id="rs-map-theme" value="#{apiFrontend.theme}" />
			<h:outputStylesheet name="webjars/openlayers/4.0.1/ol.css" />
			<h:outputStylesheet name="rs.css" library="css" />
			<h:outputScript name="webjars/openlayers/4.0.1/ol-debug.js"
				target="head" />
			<h:outputScript name="rs-debug.js" library="js" target="head" />
			<div id="rs-map">
				<select id="mapStyleList" title="Change Theme">
					<option>T</option>
					<option value="toner">Toner</option>
					<option value="terrain">Terrain</option>
					<option value="watercolor">Watercolor</option>
				</select>
			</div>
			<script type="application/ecmascript">
				
				let rsMap = new rs.Map({
				    center : [  Number($("[id$='rs-map-longitude']").val()),
				                Number( $("[id$='rs-map-latitude']").val())]
				});
				rsMap.map.on("change:size", function(event){
				    let newValue = event.target.get(event.key);
				    // change in width of map determines change in resolution
				    // so that map shows the correct sector
				    let change = event.oldValue[1]/newValue[1];
				    let view = event.target.getView();
				    view.setResolution(view.getResolution()*change);
				    console.log(change);
				});
				rsMap.map.on("change:theme", function(event){
				    console.log("theme changed");
				});
				rsMap.map.getView().on("change:center", function(event) {
				    let center = ol.proj.toLonLat(event.target.getCenter());
		            $("[id$='rs-map-longitude']").val(center[0]);
		            $("[id$='rs-map-latitude']").val(center[1]);
				});
				rsMap.map.getView().on("change:resolution",function(event){
				    $("[id$='rs-map-resolution']").val(event.target.getResolution());
				});
				rsMap.map.getView().on("change:rotation", function(event){
				    $("[id$='rs-map-rotation']").val(event.target.getRotation());
				});
            
			</script>
			<p:commandButton value="#{translation.save}"
				action="#{eventBean.persist}" />
		</div>
	</ui:define>

</ui:composition>
